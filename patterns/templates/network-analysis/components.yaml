# Pattern Template: Connected Components
# Identify clusters and isolated nodes in a network
name: components
description: "Find connected components, clusters, and isolated nodes in a graph"
version: "1.0"

derived_from:
  - patterns/raw/connected_components_001.yaml

handler: connected_components
priority: 1
success_rate: 0.95

# When this pattern applies
applicability:
  query_signals:
    - "isolated"
    - "cluster"
    - "connected"
    - "reachable"
    - "disconnected"
    - "separate .* groups"
    - "network segments"
    - "unreachable"
    - "components"
  relationship_properties:
    traversal_complexity: RED

# Ontology bindings
ontology_bindings:
  node_class: Facility
  edge_relationship: connects_to

# Handler parameters
handler_params:
  nodes_table: facilities
  edges_table: transport_routes
  edge_from_col: origin_facility_id
  edge_to_col: destination_facility_id
  min_size: 1

# Variants
variants:
  all_components:
    description: "Find all connected components"
    example_queries:
      - "Are there isolated clusters in our network?"
      - "Show network segments"
      - "Find all connected groups"
    handler_params:
      min_size: 1

  isolated_nodes:
    description: "Find nodes with no connections"
    example_queries:
      - "Which facilities have no routes?"
      - "Isolated facilities"
      - "Unreachable nodes"
    handler_params:
      min_size: 1
    output_focus: isolated_nodes

  significant_clusters:
    description: "Find components above a minimum size"
    example_queries:
      - "Major network segments"
      - "Clusters with at least 5 nodes"
    handler_params:
      min_size: 5

  connectivity_check:
    description: "Verify network is fully connected"
    example_queries:
      - "Is the network connected?"
      - "Can all facilities reach each other?"
    handler_params:
      min_size: 1
    expected_result: "component_count == 1 means fully connected"

# Use cases
use_cases:
  network_health:
    description: "Verify logistics network has no gaps"
    check: "component_count should be 1"
    action_if_fail: "Add routes to connect isolated components"

  redundancy_analysis:
    description: "Check for single points of failure"
    follow_up: "Use centrality to find critical nodes in largest component"

  expansion_planning:
    description: "Identify facilities that need new routes"
    output: "isolated_nodes list"

# Parameter resolution
parameter_mapping:
  nodes_table: "{ontology.classes.{node_class}.sql_mapping.table}"
  edges_table: "{ontology.relationships.{relationship}.sql_mapping.table}"
  edge_from_col: "{ontology.relationships.{relationship}.sql_mapping.domain_key}"
  edge_to_col: "{ontology.relationships.{relationship}.sql_mapping.range_key}"

# Example instantiation
example:
  query: "Are there any isolated facility clusters in our network?"
  handler: connected_components
  handler_params:
    nodes_table: facilities
    edges_table: transport_routes
    edge_from_col: origin_facility_id
    edge_to_col: destination_facility_id
    min_size: 1

  expected_output:
    components:
      - node_ids: [1, 2, 3, ..., 48]
        size: 48
        sample_nodes: [{name: "Chicago Warehouse"}, {name: "Dallas Hub"}, ...]
      - node_ids: [49, 50]
        size: 2
        sample_nodes: [{name: "Alaska Depot"}, {name: "Hawaii Warehouse"}]
    component_count: 2
    largest_component_size: 48
    isolated_nodes: []

  interpretation: |
    Network has 2 components:
    1. Main continental network (48 facilities)
    2. Pacific facilities (2 facilities)

    The Alaska/Hawaii facilities need routes to connect to the main network,
    or they operate independently with air/sea transport.
