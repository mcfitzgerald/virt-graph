# Pattern Template: Shortest Path
# Generalized from raw patterns for optimal route finding
name: shortest_path
description: "Find optimal path between two nodes (shortest, cheapest, fastest)"
version: "1.0"

derived_from:
  - patterns/raw/shortest_path_cost_001.yaml

handler: shortest_path
priority: 1
success_rate: 0.90

# When this pattern applies
applicability:
  query_signals:
    - "shortest"
    - "cheapest"
    - "fastest"
    - "optimal route"
    - "best path"
    - "route from .* to"
    - "how to get from"
    - "path between"
    - "minimum cost"
    - "minimum distance"
    - "quickest way"
  relationship_properties:
    is_weighted: true
    traversal_complexity: RED

# Ontology bindings
ontology_bindings:
  node_class: Facility
  edge_relationship: connects_to
  weight_options:
    cost: cost_usd
    distance: distance_km
    time: transit_time_hours

# Handler parameters
handler_params:
  nodes_table: facilities
  edges_table: transport_routes
  edge_from_col: origin_facility_id
  edge_to_col: destination_facility_id
  max_depth: 20
  # weight_col determined by variant

# Variants by optimization goal
variants:
  cheapest:
    description: "Find lowest cost route"
    example_queries:
      - "Cheapest route from Chicago to LA"
      - "Lowest cost shipping path"
      - "Minimum cost route"
    handler_params:
      weight_col: cost_usd
    weight_semantics: "Total shipping cost in USD"

  shortest_distance:
    description: "Find shortest physical distance"
    example_queries:
      - "Shortest route from A to B"
      - "Minimum distance path"
      - "Closest route"
    handler_params:
      weight_col: distance_km
    weight_semantics: "Total distance in kilometers"

  fastest:
    description: "Find quickest transit time"
    example_queries:
      - "Fastest route from factory to customer"
      - "Quickest shipping path"
      - "Minimum transit time"
    handler_params:
      weight_col: transit_time_hours
    weight_semantics: "Total transit time in hours"

  hop_count:
    description: "Find path with fewest intermediate stops"
    example_queries:
      - "Most direct route"
      - "Fewest stops between A and B"
    handler_params:
      weight_col: null  # Unweighted = hop count
    weight_semantics: "Number of intermediate facilities"

# Parameter resolution
parameter_mapping:
  nodes_table: "{ontology.classes.Facility.sql_mapping.table}"
  edges_table: "{ontology.relationships.connects_to.sql_mapping.table}"
  edge_from_col: "{ontology.relationships.connects_to.sql_mapping.domain_key}"
  edge_to_col: "{ontology.relationships.connects_to.sql_mapping.range_key}"

# Output interpretation
output_format:
  path: "List of facility IDs in order"
  path_nodes: "Full facility details for each hop"
  distance: "Total weight (cost/distance/time depending on variant)"
  edges: "Edge details including individual weights"

# Example instantiation
example:
  query: "What's the cheapest shipping route from Chicago to LA?"
  steps:
    - description: "Find facility IDs"
      sql: |
        SELECT id, name FROM facilities
        WHERE name IN ('Chicago Warehouse', 'LA Distribution Center')
      result:
        chicago_id: 1
        la_id: 25

    - description: "Find shortest path"
      handler: shortest_path
      handler_params:
        nodes_table: facilities
        edges_table: transport_routes
        edge_from_col: origin_facility_id
        edge_to_col: destination_facility_id
        start_id: 1
        end_id: 25
        weight_col: cost_usd
        max_depth: 20

  expected_output:
    path: [1, 12, 18, 25]
    distance: 2450.00
    path_description: "Chicago -> Dallas Hub -> Phoenix -> LA"
