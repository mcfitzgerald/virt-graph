# Entity Pattern: Part Lookup and Filtering
# Discovered: Phase 1A - TBox Entity Patterns
# Complexity: GREEN

name: part_entity_patterns
complexity: GREEN
description: Entity lookup and filtering patterns for Part class

ontology_bindings:
  class: Part
  table: parts
  identifier: part_number

patterns:
  - name: part_by_number
    description: "Lookup part by unique part number"
    applicability:
      keywords: [part, find, lookup, number, PRT]
      intent: "Find a specific part by its part number"
    parameters:
      - name: part_number
        type: string
        required: true
        example: "PRT-000001"
    sql_template: |
      SELECT id, part_number, description, category, unit_cost,
             weight_kg, lead_time_days, is_critical, min_stock_level
      FROM parts
      WHERE part_number = {{part_number}}
    execution:
      time_ms: 5.4
      rows: 1

  - name: part_search_by_description
    description: "Search parts by description (case-insensitive)"
    applicability:
      keywords: [part, search, description, find, like]
      intent: "Find parts matching a description pattern"
    parameters:
      - name: description_pattern
        type: string
        required: true
    sql_template: |
      SELECT id, part_number, description, category, unit_cost
      FROM parts
      WHERE description ILIKE {{description_pattern}}
      ORDER BY part_number
      LIMIT 20
    execution:
      time_ms: 6.5

  - name: parts_by_category
    description: "List parts filtered by category"
    applicability:
      keywords: [parts, category, type, Cable, Housing, Subassembly, Motor]
      intent: "Find all parts in a specific category"
    parameters:
      - name: category
        type: string
        required: true
        values: [Cable, Housing, Subassembly, Motor, Electronic, Sensor, Fastener, Raw Material, Mechanical, Assembly]
    sql_template: |
      SELECT id, part_number, description, unit_cost, is_critical, lead_time_days
      FROM parts
      WHERE category = {{category}}
      ORDER BY part_number
    execution:
      time_ms: 1.4
      result: "Cable: 528, Mechanical: 527, Motor: 524, Electronic: 517, Sensor: 503"

  - name: part_count_by_category
    description: "Aggregate part counts by category"
    applicability:
      keywords: [count, parts, category, breakdown, distribution]
      intent: "Get count of parts in each category"
    parameters: []
    sql_template: |
      SELECT category, COUNT(*) as part_count
      FROM parts
      GROUP BY category
      ORDER BY part_count DESC
    execution:
      time_ms: 1.4

  - name: critical_parts
    description: "List all critical parts"
    applicability:
      keywords: [critical, parts, important, essential, risk]
      intent: "Find all parts marked as critical"
    parameters: []
    sql_template: |
      SELECT id, part_number, description, category,
             primary_supplier_id, lead_time_days
      FROM parts
      WHERE is_critical = true
      ORDER BY lead_time_days DESC
    execution:
      time_ms: 0.4
      rows: 459

  - name: parts_by_cost_range
    description: "Aggregate parts by cost range"
    applicability:
      keywords: [parts, cost, price, range, expensive, cheap]
      intent: "Get distribution of parts by cost range"
    parameters: []
    sql_template: |
      SELECT
        CASE
          WHEN unit_cost < 10 THEN 'under_10'
          WHEN unit_cost < 100 THEN '10_to_100'
          WHEN unit_cost < 1000 THEN '100_to_1000'
          ELSE 'over_1000'
        END as cost_range,
        COUNT(*)
      FROM parts
      GROUP BY 1
      ORDER BY 1
    execution:
      time_ms: 3.1
      result: "100-1000: 4002, 10-100: 897, <10: 104"

  - name: avg_lead_time_by_category
    description: "Average lead time by part category"
    applicability:
      keywords: [lead time, average, category, procurement, days]
      intent: "Get average lead time for parts by category"
    parameters: []
    sql_template: |
      SELECT category,
             ROUND(AVG(lead_time_days)::numeric, 1) as avg_lead_time
      FROM parts
      GROUP BY category
      ORDER BY avg_lead_time DESC
    execution:
      time_ms: 3.4
      result: "Assembly: 48.1, Mechanical: 47.6, Fastener: 46.4 days"
