# Relationship Pattern: can_supply (Supplier â†’ Part)
# Discovered: Phase 1B - GREEN Relationship Patterns
# Complexity: GREEN

name: can_supply_relationship_patterns
complexity: GREEN
description: Relationship patterns for can_supply role (approved supplier list)

ontology_bindings:
  role: can_supply
  domain: Supplier
  range: Part
  sql:
    table: part_suppliers
    domain_key: supplier_id
    range_key: part_id
    additional_columns:
      - supplier_part_number
      - unit_cost
      - lead_time_days
      - is_approved

patterns:
  - name: supplier_approved_parts
    description: "Forward traversal: Find all parts a supplier can supply"
    applicability:
      keywords: [supplier, can supply, approved, parts, ASL]
      intent: "Find all parts a supplier is approved to supply"
    parameters:
      - name: supplier_code
        type: string
        required: true
      - name: approved_only
        type: boolean
        required: false
        default: true
    sql_template: |
      SELECT p.part_number, p.description, ps.supplier_part_number,
             ps.unit_cost, ps.lead_time_days, ps.is_approved
      FROM suppliers s
      JOIN part_suppliers ps ON ps.supplier_id = s.id
      JOIN parts p ON ps.part_id = p.id
      WHERE s.supplier_code = {{supplier_code}}
        AND ({{approved_only}} = false OR ps.is_approved = true)
      ORDER BY ps.unit_cost
    execution:
      time_ms: 7.8

  - name: supplier_approved_part_count
    description: "Count approved parts by supplier"
    applicability:
      keywords: [supplier, approved, count, parts, ranking]
      intent: "Get count of approved parts per supplier"
    parameters:
      - name: limit
        type: integer
        required: false
        default: 10
    sql_template: |
      SELECT s.supplier_code, s.name, COUNT(ps.part_id) as part_count,
             ROUND(AVG(ps.unit_cost)::numeric, 2) as avg_cost
      FROM suppliers s
      JOIN part_suppliers ps ON ps.supplier_id = s.id
      WHERE ps.is_approved = true
      GROUP BY s.id, s.supplier_code, s.name
      ORDER BY part_count DESC
      LIMIT {{limit}}
    execution:
      time_ms: 7.8
      result: "SUP00352: 25, SUP00419: 24, SUP00325: 23 parts"

  - name: part_approved_suppliers
    description: "Reverse traversal: Find approved suppliers for a part"
    applicability:
      keywords: [part, suppliers, approved, alternatives, ASL, sourcing]
      intent: "Find all approved suppliers for a specific part"
    parameters:
      - name: part_number
        type: string
        required: true
    sql_template: |
      SELECT p.part_number, s.supplier_code, s.name as supplier,
             ps.unit_cost, ps.lead_time_days, ps.supplier_part_number
      FROM parts p
      JOIN part_suppliers ps ON ps.part_id = p.id
      JOIN suppliers s ON ps.supplier_id = s.id
      WHERE p.part_number = {{part_number}}
        AND ps.is_approved = true
      ORDER BY ps.unit_cost
    execution:
      time_ms: 4.3
      result: "Typical: 1-3 approved suppliers per part"

  - name: parts_multi_source
    description: "Find parts with multiple approved suppliers"
    applicability:
      keywords: [parts, multiple, suppliers, sourcing, redundancy, risk]
      intent: "Find parts that have multiple approved suppliers"
    parameters:
      - name: min_suppliers
        type: integer
        required: false
        default: 2
    sql_template: |
      SELECT p.part_number, COUNT(ps.supplier_id) as supplier_count,
             MIN(ps.unit_cost) as min_cost, MAX(ps.unit_cost) as max_cost
      FROM parts p
      JOIN part_suppliers ps ON ps.part_id = p.id
      WHERE ps.is_approved = true
      GROUP BY p.id, p.part_number
      HAVING COUNT(ps.supplier_id) >= {{min_suppliers}}
      ORDER BY supplier_count DESC
    execution:
      time_ms: 4.3

  - name: fast_lead_time_suppliers
    description: "Find suppliers with fast lead times"
    applicability:
      keywords: [suppliers, fast, lead time, quick, urgent, expedite]
      intent: "Find supplier-part combinations with short lead times"
    parameters:
      - name: max_lead_time_days
        type: integer
        required: false
        default: 10
    sql_template: |
      SELECT s.name as supplier, p.part_number,
             ps.lead_time_days, ps.unit_cost
      FROM part_suppliers ps
      JOIN suppliers s ON ps.supplier_id = s.id
      JOIN parts p ON ps.part_id = p.id
      WHERE ps.is_approved = true
        AND ps.lead_time_days < {{max_lead_time_days}}
      ORDER BY ps.lead_time_days
      LIMIT 20
    execution:
      time_ms: 1.0
