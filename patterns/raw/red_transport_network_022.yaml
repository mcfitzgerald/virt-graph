# RED Pattern: connects_to (Facility → Facility) Network Algorithms
# Discovered: Phase 3 - RED Network Analysis
# Complexity: RED
# Handler: NetworkX (shortest_path, centrality, connected_components)

name: transport_network_patterns
complexity: RED
description: Network algorithm patterns for transport route network

ontology_bindings:
  role: connects_to
  domain: Facility
  range: Facility
  sql:
    table: transport_routes
    domain_key: origin_facility_id
    range_key: destination_facility_id
    weight_columns:
      - distance_km
      - cost_usd
      - transit_time_hours
  properties:
    is_weighted: true
    irreflexive: true

structure:
  total_edges: 197
  nodes: 50
  density: 0.0788
  avg_degree: 7.72
  is_connected: true
  transport_modes: [air, sea, truck, rail]

patterns:
  # ==========================================================================
  # PATHFINDING PATTERNS
  # ==========================================================================

  - name: shortest_path_distance
    description: "Find shortest path between facilities by distance"
    applicability:
      keywords: [shortest, path, route, distance, km, between, facilities]
      intent: "Find the shortest route by distance between two facilities"
    handler:
      name: shortest_path
      config:
        nodes_table: facilities
        edges_table: transport_routes
        edge_from_col: origin_facility_id
        edge_to_col: destination_facility_id
        weight_col: distance_km
    parameters:
      - name: start_facility_code
        type: string
        required: true
        example: "FAC-CHI"
      - name: end_facility_code
        type: string
        required: true
        example: "FAC-LA"
    execution:
      time_ms: 3.5
      nodes_explored: 26
      result: "FAC-CHI → FAC-LA: 3,388 km, 3 hops"

  - name: cheapest_path
    description: "Find cheapest route between facilities"
    applicability:
      keywords: [cheapest, path, route, cost, price, budget, facilities]
      intent: "Find the lowest cost route between two facilities"
    handler:
      name: shortest_path
      config:
        nodes_table: facilities
        edges_table: transport_routes
        edge_from_col: origin_facility_id
        edge_to_col: destination_facility_id
        weight_col: cost_usd
    parameters:
      - name: start_facility_code
        type: string
        required: true
      - name: end_facility_code
        type: string
        required: true
    execution:
      time_ms: 2.0
      result: "FAC-CHI → FAC-LA: $9,836.64"

  - name: fastest_path
    description: "Find fastest route between facilities by transit time"
    applicability:
      keywords: [fastest, quickest, path, route, time, hours, urgent, facilities]
      intent: "Find the fastest route by transit time between two facilities"
    handler:
      name: shortest_path
      config:
        nodes_table: facilities
        edges_table: transport_routes
        edge_from_col: origin_facility_id
        edge_to_col: destination_facility_id
        weight_col: transit_time_hours
    parameters:
      - name: start_facility_code
        type: string
        required: true
      - name: end_facility_code
        type: string
        required: true
    execution:
      time_ms: 1.6
      result: "FAC-CHI → FAC-LA: 168.4 hours"

  - name: all_optimal_routes
    description: "Find all optimal routes between facilities"
    applicability:
      keywords: [all, routes, paths, alternatives, options, between]
      intent: "Find all shortest paths when multiple equivalent routes exist"
    handler:
      name: all_shortest_paths
      config:
        nodes_table: facilities
        edges_table: transport_routes
        edge_from_col: origin_facility_id
        edge_to_col: destination_facility_id
        max_paths: 10
    parameters:
      - name: start_facility_code
        type: string
        required: true
      - name: end_facility_code
        type: string
        required: true
      - name: weight_col
        type: string
        required: false
        values: [distance_km, cost_usd, transit_time_hours]
    execution:
      time_ms: 5.0

  # ==========================================================================
  # CENTRALITY PATTERNS
  # ==========================================================================

  - name: degree_centrality
    description: "Find most connected facilities by degree"
    applicability:
      keywords: [connected, degree, centrality, hub, most connections, facilities]
      intent: "Find facilities with the most transport connections"
    handler:
      name: centrality
      config:
        nodes_table: facilities
        edges_table: transport_routes
        edge_from_col: origin_facility_id
        edge_to_col: destination_facility_id
        centrality_type: degree
    parameters:
      - name: top_n
        type: integer
        required: false
        default: 10
    execution:
      time_ms: 5.0
      result: "FAC-NYC: 0.41, FAC-042: 0.33, FAC-037: 0.29"

  - name: betweenness_centrality
    description: "Find critical bridge facilities in network"
    applicability:
      keywords: [critical, bridge, betweenness, bottleneck, key, facilities, risk]
      intent: "Find facilities that are critical bridges in the transport network"
    handler:
      name: centrality
      config:
        nodes_table: facilities
        edges_table: transport_routes
        edge_from_col: origin_facility_id
        edge_to_col: destination_facility_id
        centrality_type: betweenness
    parameters:
      - name: top_n
        type: integer
        required: false
        default: 10
    execution:
      time_ms: 3.3
      result: "FAC-NYC: 0.23, FAC-037: 0.12, FAC-048: 0.11"

  - name: pagerank_centrality
    description: "Find most important facilities by PageRank"
    applicability:
      keywords: [important, pagerank, influence, rank, facilities]
      intent: "Find most important facilities based on network position"
    handler:
      name: centrality
      config:
        nodes_table: facilities
        edges_table: transport_routes
        edge_from_col: origin_facility_id
        edge_to_col: destination_facility_id
        centrality_type: pagerank
    parameters:
      - name: top_n
        type: integer
        required: false
        default: 10
    execution:
      time_ms: 133.3
      result: "FAC-NYC: 0.05, FAC-042: 0.05, FAC-048: 0.04"

  - name: closeness_centrality
    description: "Find facilities closest to all other facilities"
    applicability:
      keywords: [closest, closeness, central, average distance, facilities]
      intent: "Find facilities with shortest average distance to all others"
    handler:
      name: centrality
      config:
        nodes_table: facilities
        edges_table: transport_routes
        edge_from_col: origin_facility_id
        edge_to_col: destination_facility_id
        centrality_type: closeness
    parameters:
      - name: top_n
        type: integer
        required: false
        default: 10
    execution:
      time_ms: 5.0

  # ==========================================================================
  # NETWORK STRUCTURE PATTERNS
  # ==========================================================================

  - name: connected_components
    description: "Find isolated clusters in transport network"
    applicability:
      keywords: [clusters, components, isolated, connected, groups, network]
      intent: "Find disconnected clusters of facilities in the transport network"
    handler:
      name: connected_components
      config:
        nodes_table: facilities
        edges_table: transport_routes
        edge_from_col: origin_facility_id
        edge_to_col: destination_facility_id
    parameters:
      - name: min_size
        type: integer
        required: false
        default: 1
    execution:
      time_ms: 1.9
      result: "1 component with all 50 facilities (fully connected)"

  - name: network_density
    description: "Calculate transport network density and statistics"
    applicability:
      keywords: [density, statistics, network, structure, overview]
      intent: "Get overall transport network statistics"
    handler:
      name: graph_density
      config:
        edges_table: transport_routes
        edge_from_col: origin_facility_id
        edge_to_col: destination_facility_id
    parameters: []
    execution:
      time_ms: 5.7
      result: "50 nodes, 193 edges, density 0.079, avg degree 7.72"

  - name: facility_neighbors
    description: "Find direct transport connections for a facility"
    applicability:
      keywords: [neighbors, connections, direct, routes, from, to, facility]
      intent: "Find facilities directly connected to a given facility"
    handler:
      name: neighbors
      config:
        nodes_table: facilities
        edges_table: transport_routes
        edge_from_col: origin_facility_id
        edge_to_col: destination_facility_id
    parameters:
      - name: facility_code
        type: string
        required: true
      - name: direction
        type: string
        required: false
        default: both
        values: [outbound, inbound, both]
    execution:
      time_ms: 2.0
