# Virtual Graph Supply Chain Ontology
# Format: TBox/RBox (Description Logic inspired, LinkML-influenced)
#
# Generated via 4-round interactive discovery protocol.
# This ontology maps semantic concepts to physical SQL schema,
# enabling graph-like queries over relational data.
#
# References:
# - LinkML: https://linkml.io/
# - OWL 2: https://www.w3.org/TR/owl-ref/
# - Description Logic: https://en.wikipedia.org/wiki/Abox

# =============================================================================
# META: Ontology Metadata
# =============================================================================
meta:
  name: supply_chain
  version: "2.1"
  created: "2025-12-05"
  format: tbox-rbox

  database:
    type: postgresql
    version: "14"
    connection: "postgresql://virt_graph:dev_password@localhost:5432/supply_chain"

# =============================================================================
# TBox: Terminological Box (Class/Concept Definitions)
# =============================================================================
# Classes represent entity types that map to database tables.

tbox:
  classes:
    Supplier:
      description: "Organizations that supply parts and materials, organized in tiers (1-3)"
      sql:
        table: suppliers
        primary_key: id
        identifier: [supplier_code]
      slots:
        supplier_code:
          range: string
          column: supplier_code
          description: "Unique supplier identifier"
          required: true
        name:
          range: string
          column: name
          description: "Supplier company name"
          required: true
        tier:
          range: integer
          column: tier
          description: "Supply chain tier (1=direct, 2=tier2, 3=raw materials)"
          required: true
          values: [1, 2, 3]
          distribution:
            tier_1: 50
            tier_2: 150
            tier_3: 300
        country:
          range: string
          column: country
          description: "Country of operation"
        city:
          range: string
          column: city
          description: "City location"
        contact_email:
          range: string
          column: contact_email
          description: "Primary contact email"
        credit_rating:
          range: string
          column: credit_rating
          description: "Financial credit rating"
        is_active:
          range: boolean
          column: is_active
          description: "Whether supplier is currently active"
        created_at:
          range: timestamp
          column: created_at
          description: "Record creation timestamp"
        updated_at:
          range: timestamp
          column: updated_at
          description: "Last update timestamp"
      soft_delete:
        enabled: true
        column: deleted_at
      row_count: 500

    Part:
      description: "Physical components and raw materials used in manufacturing"
      sql:
        table: parts
        primary_key: id
        identifier: [part_number]
      slots:
        part_number:
          range: string
          column: part_number
          description: "Unique part identifier"
          required: true
        description:
          range: string
          column: description
          description: "Part description"
        category:
          range: string
          column: category
          description: "Part category (Cable, Housing, Subassembly, etc.)"
        unit_cost:
          range: decimal
          column: unit_cost
          description: "Cost per unit"
        weight_kg:
          range: decimal
          column: weight_kg
          description: "Weight in kilograms"
        lead_time_days:
          range: integer
          column: lead_time_days
          description: "Procurement lead time in days"
        is_critical:
          range: boolean
          column: is_critical
          description: "Whether part is critical to operations"
        min_stock_level:
          range: integer
          column: min_stock_level
          description: "Minimum inventory threshold"
      soft_delete:
        enabled: true
        column: deleted_at
      row_count: 5003

    Product:
      description: "Finished goods sold to customers, composed of parts"
      sql:
        table: products
        primary_key: id
        identifier: [sku]
      slots:
        sku:
          range: string
          column: sku
          description: "Stock keeping unit"
          required: true
        name:
          range: string
          column: name
          description: "Product name"
          required: true
        description:
          range: string
          column: description
          description: "Product description"
        category:
          range: string
          column: category
          description: "Product category"
        list_price:
          range: decimal
          column: list_price
          description: "List price"
        is_active:
          range: boolean
          column: is_active
          description: "Whether product is available"
        launch_date:
          range: date
          column: launch_date
          description: "Product launch date"
        discontinued_date:
          range: date
          column: discontinued_date
          description: "Discontinuation date"
      soft_delete:
        enabled: false
      row_count: 200

    Facility:
      description: "Physical locations for manufacturing, warehousing, and distribution"
      sql:
        table: facilities
        primary_key: id
        identifier: [facility_code]
      slots:
        facility_code:
          range: string
          column: facility_code
          description: "Unique facility identifier"
          required: true
        name:
          range: string
          column: name
          description: "Facility name"
          required: true
        facility_type:
          range: string
          column: facility_type
          description: "Type of facility"
          required: true
          values: [warehouse, factory, distribution_center]
        address:
          range: string
          column: address
          description: "Street address"
        city:
          range: string
          column: city
          description: "City"
        state:
          range: string
          column: state
          description: "State/province"
        country:
          range: string
          column: country
          description: "Country"
        postal_code:
          range: string
          column: postal_code
          description: "Postal/ZIP code"
        latitude:
          range: decimal
          column: latitude
          description: "Geographic latitude"
        longitude:
          range: decimal
          column: longitude
          description: "Geographic longitude"
        capacity_units:
          range: integer
          column: capacity_units
          description: "Storage/processing capacity"
        is_active:
          range: boolean
          column: is_active
          description: "Whether facility is operational"
      soft_delete:
        enabled: false
      row_count: 50

    Customer:
      description: "End buyers who purchase products"
      sql:
        table: customers
        primary_key: id
        identifier: [customer_code]
      slots:
        customer_code:
          range: string
          column: customer_code
          description: "Unique customer identifier"
          required: true
        name:
          range: string
          column: name
          description: "Customer name"
          required: true
        customer_type:
          range: string
          column: customer_type
          description: "Type of customer"
          values: [retail, wholesale, enterprise]
        contact_email:
          range: string
          column: contact_email
          description: "Contact email"
        shipping_address:
          range: string
          column: shipping_address
          description: "Default shipping address"
        city:
          range: string
          column: city
          description: "City"
        state:
          range: string
          column: state
          description: "State/province"
        country:
          range: string
          column: country
          description: "Country"
      soft_delete:
        enabled: false
      row_count: 1000

    Order:
      description: "Customer purchase orders for products"
      sql:
        table: orders
        primary_key: id
        identifier: [order_number]
      slots:
        order_number:
          range: string
          column: order_number
          description: "Unique order number"
          required: true
        order_date:
          range: timestamp
          column: order_date
          description: "Date order was placed"
          required: true
        required_date:
          range: date
          column: required_date
          description: "Requested delivery date"
        shipped_date:
          range: timestamp
          column: shipped_date
          description: "Actual ship date"
        status:
          range: string
          column: status
          description: "Order status"
          required: true
          values: [pending, confirmed, shipped, delivered, cancelled]
        total_amount:
          range: decimal
          column: total_amount
          description: "Total order value"
        shipping_cost:
          range: decimal
          column: shipping_cost
          description: "Shipping cost"
        notes:
          range: string
          column: notes
          description: "Order notes"
      soft_delete:
        enabled: false
      row_count: 20000

    Shipment:
      description: "Physical movement of goods between facilities or to customers"
      sql:
        table: shipments
        primary_key: id
        identifier: [shipment_number]
      slots:
        shipment_number:
          range: string
          column: shipment_number
          description: "Unique shipment identifier"
          required: true
        carrier:
          range: string
          column: carrier
          description: "Shipping carrier"
        tracking_number:
          range: string
          column: tracking_number
          description: "Carrier tracking number"
        status:
          range: string
          column: status
          description: "Shipment status"
          required: true
          values: [pending, in_transit, delivered, failed]
        shipped_at:
          range: timestamp
          column: shipped_at
          description: "Ship date/time"
        delivered_at:
          range: timestamp
          column: delivered_at
          description: "Delivery date/time"
        weight_kg:
          range: decimal
          column: weight_kg
          description: "Total shipment weight"
        cost_usd:
          range: decimal
          column: cost_usd
          description: "Shipping cost"
      soft_delete:
        enabled: false
      row_count: 7995

    SupplierCertification:
      description: "Quality and compliance certifications held by suppliers"
      sql:
        table: supplier_certifications
        primary_key: id
        identifier: [supplier_id, certification_type]
      slots:
        certification_type:
          range: string
          column: certification_type
          description: "Type of certification (ISO9001, ISO14001, etc.)"
          required: true
        certification_number:
          range: string
          column: certification_number
          description: "Certificate number"
        issued_date:
          range: date
          column: issued_date
          description: "Date certification was issued"
        expiry_date:
          range: date
          column: expiry_date
          description: "Certification expiration date"
        is_valid:
          range: boolean
          column: is_valid
          description: "Whether certification is currently valid"
      soft_delete:
        enabled: false
      row_count: 721

# =============================================================================
# RBox: Role Box (Relationship/Property Definitions)
# =============================================================================
# Roles represent relationships between classes.

rbox:
  roles:
    # =========================================================================
    # YELLOW Complexity: Recursive Traversal Required
    # =========================================================================

    supplies_to:
      description: "Supplier sells to another supplier (tiered supply network)"
      domain: Supplier
      range: Supplier
      sql:
        table: supplier_relationships
        domain_key: seller_id
        range_key: buyer_id
        additional_columns:
          - relationship_type
          - contract_start_date
          - contract_end_date
          - is_primary
      properties:
        asymmetric: true
        irreflexive: true
        acyclic: true
        is_hierarchical: true
      cardinality:
        domain: "0..*"
        range: "0..*"
      traversal_complexity: YELLOW
      row_count: 817
      ddl:
        has_self_ref_constraint: true       # CHECK (seller_id != buyer_id)
        has_unique_edge_index: true         # UNIQUE (seller_id, buyer_id)
        indexed_columns: [seller_id, buyer_id]
        table_stats:
          distinct_sellers: 450
          distinct_buyers: 200

    component_of:
      description: "Part is a component of another part (BOM hierarchy)"
      domain: Part
      range: Part
      sql:
        table: bill_of_materials
        domain_key: child_part_id
        range_key: parent_part_id
        additional_columns:
          - quantity
          - unit
          - is_optional
          - assembly_sequence
      properties:
        asymmetric: true
        irreflexive: true
        acyclic: true
      inverse_of: has_component
      cardinality:
        domain: "0..*"
        range: "0..*"
      traversal_complexity: YELLOW
      row_count: 14283
      ddl:
        has_self_ref_constraint: true       # CHECK (parent_part_id != child_part_id)
        has_unique_edge_index: true         # UNIQUE (parent_part_id, child_part_id)
        indexed_columns: [parent_part_id, child_part_id]
        table_stats:
          distinct_parents: 892
          distinct_children: 4200

    # =========================================================================
    # RED Complexity: Network Algorithms Required
    # =========================================================================

    connects_to:
      description: "Transport route connects two facilities"
      domain: Facility
      range: Facility
      sql:
        table: transport_routes
        domain_key: origin_facility_id
        range_key: destination_facility_id
        additional_columns:
          - transport_mode
          - capacity_tons
          - is_active
        weight_columns:
          - name: distance_km
            type: decimal
          - name: cost_usd
            type: decimal
          - name: transit_time_hours
            type: decimal
      properties:
        irreflexive: true
        is_weighted: true
      cardinality:
        domain: "0..*"
        range: "0..*"
      traversal_complexity: RED
      row_count: 197
      ddl:
        has_self_ref_constraint: true       # CHECK (origin_facility_id != destination_facility_id)
        indexed_columns: [origin_facility_id, destination_facility_id]
        table_stats:
          distinct_origins: 50
          distinct_destinations: 50

    # =========================================================================
    # GREEN Complexity: Simple FK Joins
    # =========================================================================

    provides:
      description: "Supplier is the primary supplier for a part"
      domain: Supplier
      range: Part
      sql:
        table: parts
        domain_key: primary_supplier_id
        range_key: id
      properties:
        functional: false
        inverse_functional: true
      cardinality:
        domain: "0..*"
        range: "0..1"
      traversal_complexity: GREEN

    can_supply:
      description: "Supplier can provide a part (approved supplier list)"
      domain: Supplier
      range: Part
      sql:
        table: part_suppliers
        domain_key: supplier_id
        range_key: part_id
        additional_columns:
          - supplier_part_number
          - unit_cost
          - lead_time_days
          - is_approved
      cardinality:
        domain: "0..*"
        range: "0..*"
      traversal_complexity: GREEN
      row_count: 7582

    holds_certification:
      description: "Supplier holds a certification"
      domain: Supplier
      range: SupplierCertification
      sql:
        table: supplier_certifications
        domain_key: supplier_id
        range_key: id
      properties:
        inverse_functional: true
      cardinality:
        domain: "0..*"
        range: "1..1"
      traversal_complexity: GREEN
      row_count: 721

    contains_component:
      description: "Product contains a part as a component"
      domain: Product
      range: Part
      sql:
        table: product_components
        domain_key: product_id
        range_key: part_id
        additional_columns:
          - quantity
          - is_required
      cardinality:
        domain: "0..*"
        range: "0..*"
      traversal_complexity: GREEN
      row_count: 619

    placed_by:
      description: "Order was placed by a customer"
      domain: Order
      range: Customer
      sql:
        table: orders
        domain_key: customer_id
        range_key: id
      properties:
        functional: true
      cardinality:
        domain: "1..1"
        range: "0..*"
      traversal_complexity: GREEN
      row_count: 20000

    contains_item:
      description: "Order contains a product as a line item"
      domain: Order
      range: Product
      sql:
        table: order_items
        domain_key: order_id
        range_key: product_id
        additional_columns:
          - quantity
          - unit_price
          - discount_percent
      cardinality:
        domain: "1..*"
        range: "0..*"
      traversal_complexity: GREEN
      row_count: 60241

    ships_from:
      description: "Order ships from a facility"
      domain: Order
      range: Facility
      sql:
        table: orders
        domain_key: shipping_facility_id
        range_key: id
      properties:
        functional: true
      cardinality:
        domain: "0..1"
        range: "0..*"
      traversal_complexity: GREEN
      row_count: 20000

    fulfills:
      description: "Shipment fulfills an order"
      domain: Shipment
      range: Order
      sql:
        table: shipments
        domain_key: order_id
        range_key: id
      cardinality:
        domain: "0..1"
        range: "0..*"
      traversal_complexity: GREEN
      row_count: 7995

    originates_at:
      description: "Shipment originates from a facility"
      domain: Shipment
      range: Facility
      sql:
        table: shipments
        domain_key: origin_facility_id
        range_key: id
      properties:
        functional: true
      cardinality:
        domain: "1..1"
        range: "0..*"
      traversal_complexity: GREEN
      row_count: 7995

    stores:
      description: "Facility stores inventory of a part"
      domain: Facility
      range: Part
      sql:
        table: inventory
        domain_key: facility_id
        range_key: part_id
        additional_columns:
          - quantity_on_hand
          - quantity_reserved
          - quantity_on_order
          - reorder_point
      cardinality:
        domain: "0..*"
        range: "0..*"
      traversal_complexity: GREEN
      row_count: 10056
