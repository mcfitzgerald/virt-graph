# Supply Chain Domain Ontology for Virtual Graph
# Generated via 4-round interactive discovery protocol
#
# Entity Classes (TBox): 9 classes
# Relationship Classes (RBox): 15 relationships
#
# Validation:
#   Layer 1: poetry run linkml-lint --validate-only ontology/supply_chain.yaml
#   Layer 2: OntologyAccessor("ontology/supply_chain.yaml", validate=True)

id: https://virt-graph.dev/schemas/supply_chain
name: supply_chain
version: "1.0"
description: >-
  Supply chain domain ontology for Virtual Graph.
  Models suppliers, parts, products, facilities, customers, orders,
  shipments, and their relationships including tiered supplier networks,
  bill of materials hierarchies, and weighted transport routes.

prefixes:
  linkml: https://w3id.org/linkml/
  vg: https://virt-graph.dev/

imports:
  - linkml:types

default_range: string

annotations:
  vg:database_type: postgresql
  vg:database_version: "14"
  vg:connection_string: "postgresql://virt_graph:dev_password@localhost:5432/supply_chain"

# =============================================================================
# CLASSES
# =============================================================================
classes:

  # ===========================================================================
  # ENTITY CLASSES (TBox)
  # ===========================================================================

  Supplier:
    description: "Organization that provides parts or services in the supply chain"
    instantiates:
      - vg:SQLMappedClass
    annotations:
      vg:table: suppliers
      vg:primary_key: id
      vg:identifier: "[supplier_code]"
      vg:soft_delete_column: deleted_at
      vg:row_count: 500
    attributes:
      supplier_code:
        range: string
        required: true
        description: "Unique supplier identifier"
      name:
        range: string
        required: true
        description: "Supplier name"
      tier:
        range: integer
        required: true
        description: "Supply chain tier (1, 2, or 3)"
      country:
        range: string
        description: "Country of operation"
      city:
        range: string
        description: "City of operation"
      contact_email:
        range: string
        description: "Primary contact email"
      credit_rating:
        range: string
        description: "Credit rating assessment"
      is_active:
        range: boolean
        description: "Whether supplier is currently active"

  Part:
    description: "Component or raw material used in manufacturing"
    instantiates:
      - vg:SQLMappedClass
    annotations:
      vg:table: parts
      vg:primary_key: id
      vg:identifier: "[part_number]"
      vg:soft_delete_column: deleted_at
      vg:row_count: 5008
    attributes:
      part_number:
        range: string
        required: true
        description: "Unique part identifier"
      description:
        range: string
        description: "Part description"
      category:
        range: string
        description: "Part category"
      unit_cost:
        range: decimal
        description: "Cost per unit"
      weight_kg:
        range: decimal
        description: "Weight in kilograms"
      lead_time_days:
        range: integer
        description: "Lead time in days"
      is_critical:
        range: boolean
        description: "Whether part is critical to operations"
      min_stock_level:
        range: integer
        description: "Minimum stock level threshold"

  Product:
    description: "Finished good available for sale"
    instantiates:
      - vg:SQLMappedClass
    annotations:
      vg:table: products
      vg:primary_key: id
      vg:identifier: "[sku]"
      vg:row_count: 200
    attributes:
      sku:
        range: string
        required: true
        description: "Stock keeping unit"
      name:
        range: string
        required: true
        description: "Product name"
      description:
        range: string
        description: "Product description"
      category:
        range: string
        description: "Product category"
      list_price:
        range: decimal
        description: "List price"
      is_active:
        range: boolean
        description: "Whether product is currently active"
      launch_date:
        range: date
        description: "Product launch date"
      discontinued_date:
        range: date
        description: "Date product was discontinued"

  Facility:
    description: "Physical location (warehouse, factory, distribution center)"
    instantiates:
      - vg:SQLMappedClass
    annotations:
      vg:table: facilities
      vg:primary_key: id
      vg:identifier: "[facility_code]"
      vg:row_count: 50
    attributes:
      facility_code:
        range: string
        required: true
        description: "Unique facility identifier"
      name:
        range: string
        required: true
        description: "Facility name"
      facility_type:
        range: string
        required: true
        description: "Type of facility (warehouse, factory, etc.)"
      address:
        range: string
        description: "Street address"
      city:
        range: string
        description: "City"
      state:
        range: string
        description: "State or province"
      country:
        range: string
        description: "Country"
      postal_code:
        range: string
        description: "Postal code"
      latitude:
        range: decimal
        description: "Geographic latitude"
      longitude:
        range: decimal
        description: "Geographic longitude"
      capacity_units:
        range: integer
        description: "Storage capacity in units"
      is_active:
        range: boolean
        description: "Whether facility is currently active"

  Customer:
    description: "Organization or individual that purchases products"
    instantiates:
      - vg:SQLMappedClass
    annotations:
      vg:table: customers
      vg:primary_key: id
      vg:identifier: "[customer_code]"
      vg:row_count: 1000
    attributes:
      customer_code:
        range: string
        required: true
        description: "Unique customer identifier"
      name:
        range: string
        required: true
        description: "Customer name"
      customer_type:
        range: string
        description: "Type of customer"
      contact_email:
        range: string
        description: "Primary contact email"
      shipping_address:
        range: string
        description: "Default shipping address"
      city:
        range: string
        description: "City"
      state:
        range: string
        description: "State or province"
      country:
        range: string
        description: "Country"

  Order:
    description: "Customer purchase order"
    instantiates:
      - vg:SQLMappedClass
    annotations:
      vg:table: orders
      vg:primary_key: id
      vg:identifier: "[order_number]"
      vg:row_count: 20000
    attributes:
      order_number:
        range: string
        required: true
        description: "Unique order identifier"
      order_date:
        range: datetime
        required: true
        description: "Date order was placed"
      required_date:
        range: date
        description: "Requested delivery date"
      shipped_date:
        range: datetime
        description: "Actual ship date"
      status:
        range: string
        required: true
        description: "Order status"
      total_amount:
        range: decimal
        description: "Total order amount"
      shipping_cost:
        range: decimal
        description: "Shipping cost"
      notes:
        range: string
        description: "Order notes"

  Shipment:
    description: "Physical movement of goods between facilities or to customers"
    instantiates:
      - vg:SQLMappedClass
    annotations:
      vg:table: shipments
      vg:primary_key: id
      vg:identifier: "[shipment_number]"
      vg:row_count: 7995
    attributes:
      shipment_number:
        range: string
        required: true
        description: "Unique shipment identifier"
      carrier:
        range: string
        description: "Shipping carrier"
      tracking_number:
        range: string
        description: "Carrier tracking number"
      status:
        range: string
        required: true
        description: "Shipment status"
      shipped_at:
        range: datetime
        description: "Ship timestamp"
      delivered_at:
        range: datetime
        description: "Delivery timestamp"
      weight_kg:
        range: decimal
        description: "Total weight in kilograms"
      cost_usd:
        range: decimal
        description: "Shipping cost in USD"

  Inventory:
    description: "Stock position of a part at a specific facility"
    instantiates:
      - vg:SQLMappedClass
    annotations:
      vg:table: inventory
      vg:primary_key: id
      vg:row_count: 10032
    attributes:
      quantity_on_hand:
        range: integer
        required: true
        description: "Current quantity in stock"
      quantity_reserved:
        range: integer
        required: true
        description: "Quantity reserved for orders"
      quantity_on_order:
        range: integer
        required: true
        description: "Quantity on order from suppliers"
      reorder_point:
        range: integer
        description: "Stock level triggering reorder"
      last_counted_at:
        range: datetime
        description: "Last physical count timestamp"

  SupplierCertification:
    description: "Quality or compliance certification held by a supplier"
    instantiates:
      - vg:SQLMappedClass
    annotations:
      vg:table: supplier_certifications
      vg:primary_key: id
      vg:row_count: 707
    attributes:
      certification_type:
        range: string
        required: true
        description: "Type of certification (ISO, etc.)"
      certification_number:
        range: string
        description: "Certificate number"
      issued_date:
        range: date
        description: "Date certification was issued"
      expiry_date:
        range: date
        description: "Certification expiry date"
      is_valid:
        range: boolean
        description: "Whether certification is currently valid"

  # ===========================================================================
  # RELATIONSHIP CLASSES (RBox)
  # ===========================================================================

  # ---------------------------------------------------------------------------
  # YELLOW Complexity - Recursive Traversal
  # ---------------------------------------------------------------------------

  SuppliesTo:
    description: "Supplier sells to another supplier (tiered supply network)"
    instantiates:
      - vg:SQLMappedRelationship
    annotations:
      vg:edge_table: supplier_relationships
      vg:domain_key: seller_id
      vg:range_key: buyer_id
      vg:domain_class: Supplier
      vg:range_class: Supplier
      vg:traversal_complexity: YELLOW
      vg:traversal_semantics: >-
        inbound: Find suppliers who sell TO this entity (upstream suppliers).
        outbound: Find entities this supplier sells TO (downstream buyers).
        Example: To find all upstream suppliers of Acme Corp, use direction=inbound.
      vg:asymmetric: true
      vg:irreflexive: true
      vg:acyclic: true
      vg:is_hierarchical: true
      vg:cardinality_domain: "0..*"
      vg:cardinality_range: "0..*"
      vg:has_self_ref_constraint: true
      vg:row_count: 822
    attributes:
      relationship_type:
        range: string
        description: "Type of supplier relationship"
      contract_start_date:
        range: date
        description: "Contract start date"
      contract_end_date:
        range: date
        description: "Contract end date"
      is_primary:
        range: boolean
        description: "Whether this is the primary relationship"

  ComponentOf:
    description: "Part is a component of another part (BOM hierarchy, child to parent)"
    instantiates:
      - vg:SQLMappedRelationship
    annotations:
      vg:edge_table: bill_of_materials
      vg:domain_key: child_part_id
      vg:range_key: parent_part_id
      vg:domain_class: Part
      vg:range_class: Part
      vg:traversal_complexity: YELLOW
      vg:traversal_semantics: >-
        inbound: Find parts that are components OF me (my sub-components).
        outbound: Find parts that contain me (what I am a component of).
        Example: To find all parent assemblies containing CHIP-001, use direction=outbound.
      vg:asymmetric: true
      vg:irreflexive: true
      vg:acyclic: true
      vg:cardinality_domain: "0..*"
      vg:cardinality_range: "0..*"
      vg:has_self_ref_constraint: true
      vg:row_count: 14285
      vg:inverse_of: HasComponent
    attributes:
      quantity:
        range: integer
        required: true
        description: "Quantity required"
      unit:
        range: string
        description: "Unit of measure"
      is_optional:
        range: boolean
        description: "Whether component is optional"
      assembly_sequence:
        range: integer
        description: "Assembly order"
      notes:
        range: string
        description: "Assembly notes"

  HasComponent:
    description: "Part has another part as component (BOM explosion, parent to child)"
    instantiates:
      - vg:SQLMappedRelationship
    annotations:
      vg:edge_table: bill_of_materials
      vg:domain_key: parent_part_id
      vg:range_key: child_part_id
      vg:domain_class: Part
      vg:range_class: Part
      vg:traversal_complexity: YELLOW
      vg:traversal_semantics: >-
        inbound: Find parts that contain me (parent assemblies).
        outbound: Find parts that are my sub-components (BOM explosion).
        Example: To explode Turbo Encabulator BOM, use direction=outbound.
      vg:asymmetric: true
      vg:irreflexive: true
      vg:acyclic: true
      vg:cardinality_domain: "0..*"
      vg:cardinality_range: "0..*"
      vg:has_self_ref_constraint: true
      vg:row_count: 14285
      vg:inverse_of: ComponentOf
    attributes:
      quantity:
        range: integer
        required: true
        description: "Quantity required"
      unit:
        range: string
        description: "Unit of measure"
      is_optional:
        range: boolean
        description: "Whether component is optional"
      assembly_sequence:
        range: integer
        description: "Assembly order"

  # ---------------------------------------------------------------------------
  # RED Complexity - Network Algorithms
  # ---------------------------------------------------------------------------

  ConnectsTo:
    description: "Transport route connecting two facilities (weighted network)"
    instantiates:
      - vg:SQLMappedRelationship
    annotations:
      vg:edge_table: transport_routes
      vg:domain_key: origin_facility_id
      vg:range_key: destination_facility_id
      vg:domain_class: Facility
      vg:range_class: Facility
      vg:traversal_complexity: RED
      vg:traversal_semantics: >-
        inbound: Find facilities with routes arriving at this facility.
        outbound: Find facilities reachable from this facility (departing routes).
        Example: To find all facilities reachable from Chicago Warehouse, use direction=outbound.
      vg:irreflexive: true
      vg:is_weighted: true
      vg:weight_columns: '[{"name": "distance_km", "type": "decimal", "unit": "km"}, {"name": "transit_time_hours", "type": "decimal", "unit": "hours"}, {"name": "cost_usd", "type": "decimal", "unit": "usd"}]'
      vg:cardinality_domain: "0..*"
      vg:cardinality_range: "0..*"
      vg:has_self_ref_constraint: true
      vg:row_count: 212
    attributes:
      transport_mode:
        range: string
        required: true
        description: "Mode of transport (truck, rail, air, sea)"
      distance_km:
        range: decimal
        description: "Distance in kilometers"
      transit_time_hours:
        range: decimal
        description: "Transit time in hours"
      cost_usd:
        range: decimal
        description: "Transport cost in USD"
      capacity_tons:
        range: decimal
        description: "Capacity in metric tons"
      is_active:
        range: boolean
        description: "Whether route is currently active"

  # ---------------------------------------------------------------------------
  # GREEN Complexity - Simple FK Joins
  # ---------------------------------------------------------------------------

  PrimarySupplier:
    description: "Part has a designated primary supplier"
    instantiates:
      - vg:SQLMappedRelationship
    annotations:
      vg:edge_table: parts
      vg:domain_key: primary_supplier_id
      vg:range_key: id
      vg:domain_class: Part
      vg:range_class: Supplier
      vg:traversal_complexity: GREEN
      vg:functional: true
      vg:cardinality_domain: "0..1"
      vg:cardinality_range: "0..*"

  CanSupply:
    description: "Supplier is approved to supply a part"
    instantiates:
      - vg:SQLMappedRelationship
    annotations:
      vg:edge_table: part_suppliers
      vg:domain_key: supplier_id
      vg:range_key: part_id
      vg:domain_class: Supplier
      vg:range_class: Part
      vg:traversal_complexity: GREEN
      vg:cardinality_domain: "0..*"
      vg:cardinality_range: "0..*"
      vg:row_count: 7587
    attributes:
      supplier_part_number:
        range: string
        description: "Supplier's part number"
      unit_cost:
        range: decimal
        description: "Supplier's unit cost"
      lead_time_days:
        range: integer
        description: "Lead time in days"
      is_approved:
        range: boolean
        description: "Whether supplier is approved"
      approval_date:
        range: date
        description: "Approval date"

  ContainsComponent:
    description: "Product contains a part as direct component"
    instantiates:
      - vg:SQLMappedRelationship
    annotations:
      vg:edge_table: product_components
      vg:domain_key: product_id
      vg:range_key: part_id
      vg:domain_class: Product
      vg:range_class: Part
      vg:traversal_complexity: GREEN
      vg:cardinality_domain: "0..*"
      vg:cardinality_range: "0..*"
      vg:row_count: 612
    attributes:
      quantity:
        range: integer
        required: true
        description: "Quantity required"
      is_required:
        range: boolean
        description: "Whether component is required"

  PlacedBy:
    description: "Order was placed by a customer"
    instantiates:
      - vg:SQLMappedRelationship
    annotations:
      vg:edge_table: orders
      vg:domain_key: customer_id
      vg:range_key: id
      vg:domain_class: Order
      vg:range_class: Customer
      vg:traversal_complexity: GREEN
      vg:functional: true
      vg:cardinality_domain: "0..1"
      vg:cardinality_range: "0..*"

  ShipsFrom:
    description: "Order ships from a facility"
    instantiates:
      - vg:SQLMappedRelationship
    annotations:
      vg:edge_table: orders
      vg:domain_key: shipping_facility_id
      vg:range_key: id
      vg:domain_class: Order
      vg:range_class: Facility
      vg:traversal_complexity: GREEN
      vg:functional: true
      vg:cardinality_domain: "0..1"
      vg:cardinality_range: "0..*"

  OrderContains:
    description: "Order contains products as line items"
    instantiates:
      - vg:SQLMappedRelationship
    annotations:
      vg:edge_table: order_items
      vg:domain_key: order_id
      vg:range_key: product_id
      vg:domain_class: Order
      vg:range_class: Product
      vg:traversal_complexity: GREEN
      vg:cardinality_domain: "1..*"
      vg:cardinality_range: "0..*"
      vg:row_count: 60246
    attributes:
      quantity:
        range: integer
        required: true
        description: "Quantity ordered"
      unit_price:
        range: decimal
        required: true
        description: "Unit price at time of order"
      discount_percent:
        range: decimal
        description: "Discount percentage applied"

  InventoryAt:
    description: "Inventory record is located at a facility"
    instantiates:
      - vg:SQLMappedRelationship
    annotations:
      vg:edge_table: inventory
      vg:domain_key: facility_id
      vg:range_key: id
      vg:domain_class: Inventory
      vg:range_class: Facility
      vg:traversal_complexity: GREEN
      vg:functional: true
      vg:cardinality_domain: "1..1"
      vg:cardinality_range: "0..*"
      vg:row_count: 10032

  InventoryOf:
    description: "Inventory record tracks stock of a part"
    instantiates:
      - vg:SQLMappedRelationship
    annotations:
      vg:edge_table: inventory
      vg:domain_key: part_id
      vg:range_key: id
      vg:domain_class: Inventory
      vg:range_class: Part
      vg:traversal_complexity: GREEN
      vg:functional: true
      vg:cardinality_domain: "1..1"
      vg:cardinality_range: "0..*"
      vg:row_count: 10032

  HasCertification:
    description: "Supplier holds a certification"
    instantiates:
      - vg:SQLMappedRelationship
    annotations:
      vg:edge_table: supplier_certifications
      vg:domain_key: supplier_id
      vg:range_key: id
      vg:domain_class: Supplier
      vg:range_class: SupplierCertification
      vg:traversal_complexity: GREEN
      vg:cardinality_domain: "0..*"
      vg:cardinality_range: "1..1"
      vg:row_count: 707

  ForOrder:
    description: "Shipment fulfills an order"
    instantiates:
      - vg:SQLMappedRelationship
    annotations:
      vg:edge_table: shipments
      vg:domain_key: order_id
      vg:range_key: id
      vg:domain_class: Shipment
      vg:range_class: Order
      vg:traversal_complexity: GREEN
      vg:functional: true
      vg:cardinality_domain: "0..1"
      vg:cardinality_range: "0..*"

  OriginatesAt:
    description: "Shipment originates from a facility"
    instantiates:
      - vg:SQLMappedRelationship
    annotations:
      vg:edge_table: shipments
      vg:domain_key: origin_facility_id
      vg:range_key: id
      vg:domain_class: Shipment
      vg:range_class: Facility
      vg:traversal_complexity: GREEN
      vg:functional: true
      vg:cardinality_domain: "1..1"
      vg:cardinality_range: "0..*"

  UsesRoute:
    description: "Shipment uses a transport route"
    instantiates:
      - vg:SQLMappedRelationship
    annotations:
      vg:edge_table: shipments
      vg:domain_key: transport_route_id
      vg:range_key: id
      vg:domain_class: Shipment
      vg:range_class: Facility
      vg:traversal_complexity: GREEN
      vg:functional: true
      vg:cardinality_domain: "0..1"
      vg:cardinality_range: "0..*"
