# Prism Consumer Goods - Neo4j Container (Benchmarking)
#
# Spec: magical-launching-forest.md Phase 6
# Purpose: Neo4j baseline for comparing graph query performance against VG/SQL
#
# Usage:
#   docker-compose up -d        # Start container
#   docker-compose down         # Stop container
#   docker-compose down -v      # Stop and remove volumes (full reset)
#
# Connection:
#   HTTP Browser: http://localhost:7475
#   Bolt: bolt://localhost:7688
#   User: neo4j
#   Password: dev_password
#
# Note: Ports 7475/7688 to avoid conflict with supply_chain_example (7474/7687)

services:
  neo4j:
    image: neo4j:5.15-community
    container_name: prism-fmcg-neo4j
    ports:
      - "7475:7474"  # HTTP (Browser) - mapped to 7475
      - "7688:7687"  # Bolt (Driver) - mapped to 7688
    environment:
      NEO4J_AUTH: neo4j/dev_password
      NEO4J_PLUGINS: '["apoc", "graph-data-science"]'
      # Performance tuning for Neo4j 5.x (increased for FMCG scale)
      NEO4J_server_memory_heap_initial__size: 1G
      NEO4J_server_memory_heap_max__size: 2G
      NEO4J_server_memory_pagecache_size: 1G
      # Disable strict config validation for flexibility
      NEO4J_server_config_strict__validation_enabled: "false"
    volumes:
      - prism_fmcg_neo4j_data:/data
      - prism_fmcg_neo4j_logs:/logs
      - prism_fmcg_neo4j_import:/var/lib/neo4j/import
    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://localhost:7474"]
      interval: 10s
      timeout: 5s
      retries: 10
      start_period: 30s

volumes:
  prism_fmcg_neo4j_data:
  prism_fmcg_neo4j_logs:
  prism_fmcg_neo4j_import:
